{{>layout/header}}
<div class="card">
  <ul class="card-header">
    <div class="mb-1" style="text-align: center">
      <h5>{{{question.title}}}</h5>
    </div>

    <small style="text-align: left;"><span><a href="/search/user?no=1&id={{question.userId}}" style="color: #a7a7a7;">{{question.userId}}</a> &nbsp;  &nbsp; </span>
    </small>
    <small style="text-align: left;"><span style="color: #a7a7a7;">{{question.createDate}} &nbsp;  &nbsp; </span>
    </small>
    {{#updateButton}}
      <small style="text-align: left;">
        <a href="#" id="btn-update" style="color: #a7a7a7;">수정 &nbsp; &nbsp; </a></small>
      <small style="text-align: left;">
        <a href="#" id="btn-delete" style="color: #a7a7a7;">삭제 &nbsp; &nbsp; </a></small>
    {{/updateButton}}
    </strong>
  </ul>
  <div class="card-body">
    <pre style="text-align:left;"><p class="card-text">{{{question.content}}}</p></pre>
  </div>
  <div class="card-footer text-muted" style="text-align: right">
    <div style="float: left">
      답변 수 : {{answers.size}}개
    </div>
    <div style="float: right">
      <input type="button" id="answer-button" class="btn btn-outline-success" value="답변 작성"/>
      <input type="button" id="answer-cancel" class="btn btn-outline-success" value="취소"
             style="float: right"/>
      <input type="button" id="answer-save" class="btn btn-outline-success" value="확인"
             style="float: right"/>
    </div>
  </div>
</div>
<div id="answer-form" style="display: none">
  <form>
    <div class="form-group">
      <textarea id="summernote" name="editordata"></textarea>
    </div>
  </form>
</div>
<div class="list-group">
  {{#answers}}
    <div class="list-group-item">
      <div class="d-flex w-100 justify-content-between">
        <small style="color: #a7a7a7;">{{createDate}}</small>
      </div>
      <pre><p class="mb-1" style="color: #a7a7a7;">{{{content}}}</p></pre>
      <small><a href="/search/user?no=1&id={{userId}}" style="color: #a7a7a7;">user : {{userId}}</a></small>
    </div>
  {{/answers}}
</div>

<input type="hidden" id="id" value="{{question.id}}"/>
{{>layout/footer}}


<script>
  var delete_click = true;
  var update_click = true
  var save_click = true;
  document.getElementById('answer-cancel').style.display = "none";
  document.getElementById('answer-save').style.display = "none";

  var main = {
    init: function () {
      var _this = this;
      $('#answer-button').on('click', function () {
        document.getElementById('answer-button').style.display = "none";
        document.getElementById('answer-form').style.display = "block";
        document.getElementById('answer-cancel').style.display = "block";
        document.getElementById('answer-save').style.display = "block";
      });
      $('#answer-save').on('click', function () {
        if (save_click) {
          var content = $('#summernote').val()
          if (content.trim() === "" || content === null) {
            alert("내용을 입력하세요!")
            return;
          }
          _this.save();
          save_click = !save_click;

          // 타이밍 추가
          setTimeout(function () {
            click = true;
          }, 2000)

        } else {
          alert("처리중 입니다!");
        }
      });
      $('#answer-cancel').on('click', function () {
        document.getElementById('answer-button').style.display = "block";
        document.getElementById('answer-save').style.display = "none";
        document.getElementById('answer-cancel').style.display = "none";
        document.getElementById('answer-form').style.display = "none";
      });
      $('#btn-delete').on('click', function () {
        if (delete_click) {
          if (confirm("글을 삭제하시겠습니까?") == false) {
            return;
          }
          _this.delete();
          delete_click = !delete_click;

          // 타이밍 추가
          setTimeout(function () {
            delete_click = true;
          }, 2000)

        } else {
          alert("처리중 입니다!");
        }
      });
      $('#btn-update').on('click', function () {
        _this.update();
      });
    },
    save: function () {
      var data = {
        content: $('#summernote').val(),
        questionId: $('#id').val(),
      };
      $.ajax({
        type: 'POST',
        url: '/api/v1/answers',
        dataType: 'text',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
      }).done(function () {
        alert('답변이 등록되었습니다.');
        window.location.href = '/questions/' + $('#id').val();
      }).fail(function (error) {
        alert(error.responseText);
      });
    },
    update: function () {
      var id = $('#id').val();
      $.ajax({
        type: 'GET',
        url: '/questions/update/' + id,
        dataType: 'text',
        contentType: 'application/json; charset=utf-8',
      }).done(function () {
        window.location.href = '/questions/update/' + id;
      }).fail(function (error) {
        if (error.status == 403) {
          alert('본인의 게시물만 수정할 수 있습니다.');
        }
      })
    },
    delete: function () {
      var id = $('#id').val();
      $.ajax({
        type: 'DELETE',
        url: '/api/v1/questions/' + id,
        dataType: 'text',
        contentType: 'application/json; charset=utf-8',
      }).done(function () {
        alert('글이 삭제되었습니다.');
        window.location.href = '/';
      }).fail(function (error) {
        alert(error.responseText);
        if (error.status == 401) {
          window.location.href = '/user/login';
        }
      })
    }
  };
  $(document).ready(function () {
    //여기 아래 부분
    $('#summernote').summernote({
      height: 500,                 // 에디터 높이
      minHeight: 500,             // 최소 높이
      maxHeight: 500,             // 최대 높이
      focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
      lang: "ko-KR",					// 한글 설정
      placeholder: '내용을 입력해주세요.',	//placeholder 설정
      toolbar: [
        // [groupName, [list of button]]
        ['fontname', ['fontname']],
        ['fontsize', ['fontsize']],
        ['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
        ['color', ['forecolor', 'color']],
        ['table', ['table']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']],
        ['insert', ['picture', 'link', 'video']],
        ['view', ['fullscreen', 'help']]
      ],
      fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', '맑은 고딕', '궁서', '굴림체',
        '굴림', '돋음체', '바탕체'],
      fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36',
        '50', '72']
    });
  });
  main.init();
</script>
<script src="/js/summernote/summernote-lite.js"></script>
<script src="/js/summernote/lang/summernote-ko-KR.js"></script>
<link rel="stylesheet" href="/css/summernote/summernote-lite.css">